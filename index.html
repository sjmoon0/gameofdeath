<html>

<head>
	<!--<script src="./drawBoard.js" type="application/javascript"></script>-->
	<script src="/socket.io/socket.io.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
</head>

<body>
	<nav class="navbar navbar-default navbar-static-top" role="navigation">
	  <div class="container">
	  	<div class="navbar-header"><a class="navbar-brand">Game Of Death</a></div>
	  </div>
	</nav>

	<!-- Display this upon player login. Adjust bar accordingly after each player logs in.-->
	<!-- Hide this when 4 players login.-->
	<div id="welcome" class="container jumbotron" style="padding-left:5%;padding-right:5%;">
		<div class="row container-fluid">
			<h3>Waiting for all players to join...</h3>
			<div class="progress">
			  <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 25%">
			    <span class="sr-only">45% Complete</span>
			  </div>
			</div>
		</div>
	</div>

	<!-- Display this when 4 players have logged in.-->
	<!-- When a player chooses one, send choice to server. -->
	<!-- Server should constantly update available choices. Darken unavailable choices.-->
	<div id="choosecharacter" class="container jumbotron">
		<div class="row container-fluid" style="text-align:center;">
		  <h2>Please choose a character</h2>
		  <div class="col-xs-6 col-md-3">
		    <a href="#" id="Ape" class="thumbnail" style="background-color:blue;height:50px;width:100%;color:white;">Ape</a>
		  </div>
		  <div class="col-xs-6 col-md-3">
		    <a href="#" id="Bob" class="thumbnail" style="background-color:red;height:50px;width:100%;color:white;">Bob</a>
		  </div>
		  <div class="col-xs-6 col-md-3">
		    <a href="#" id="Cow" class="thumbnail" style="background-color:purple;height:50px;width:100%;color:white;">Cow</a>
		  </div>
		  <div class="col-xs-6 col-md-3">
		    <a href="#" id="Dan" class="thumbnail" style="background-color:green;height:50px;width:100%;color:white;">Dan</a>
		  </div>
		</div>
	</div>

	<!--  Display this when a player has chosen his character and is waiting for others to choose theirs-->
	<div id="wait" class="container jumbotron" style="padding-left:5%;padding-right:5%;">
		<div class="row container-fluid">
			<h3>You chose <b id="charchoice"></b>! Excellent choice.<h3>
			<div class="progress">
			  <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 25%">
			    <span class="sr-only">45% Complete</span>
			  </div>
			</div>
			<h3>Waiting for all players to choose character...</h3>
		</div>
	</div>

	<center id="gamespace">
		<canvas id="c" width="800" height='600'></canvas>
	</center>


</body>


<script>
  var socket = io.connect('http://131.118.95.193',{'forceNew':true});//io('http://131.118.95.193');
  socket.on('load', function (data) {
    console.log(data);
    socket.emit('check_game_started', { my: 'data' });
    socket.on('last_client_loaded', function(hasStarted){
    	console.log("Has game started? :"+hasStarted);
    	if(hasStarted==true){
    		$('#choosecharacter').show();
    	}
    });
  });

  socket.on('client_counter', function (data) {
    console.log(data);
    incrementLoadBar(data);
  });

  socket.on('client_disconnect', function (data) {
    console.log(data);
  });

  socket.on('game_started', function (data) {
    console.log(data);
    $('#welcome').hide();
    $('#choosecharacter').show();
  });

  socket.on('disable_player_choice', function(data){
  	var id=data.stuff[0].chara;
  	incrementLoadBar(data.stuff[0].numChar);
  	console.log(id +" was chosen");
  	$('#'+id).hide();
  });

  socket.on('start_gameplay',function(nonsense){
	//The data passed into this (nonsense) will be all player location data.
	//That data should be passed into a function that renders the board
	/*
	socket.on('take_turn', function(boardChange){
		//This data (boardChange) should also be passed into a function that renders board
		if(boardChange.nextPlayerID==myID){
			//Display Dice to roll
			socket.emit('roll_dice','no data necessary');
			//While waiting for dice roll, display spinning dice
			socket.on('roll_result', function(roll){
				//Display Dice roll
			});
			//vvv This vvv should be called by a jquery selector on click after dice roll
			//socket.emit('end_turn', 'no data necessary');
		}
	});
	*/
	$('#wait').hide();
	$('#gamespace').show();
	draw_c();
  });

</script>

<script>
	$(document).ready(function(){
		$('#choosecharacter').hide();
		$('#wait').hide();
		//$('#welcome').hide();
		//$('#gamespace').show();
		//draw_c();
	});

	$('.thumbnail').click(function(something){
		socket.emit('player_chosen', something.target.id);
		$('#choosecharacter').hide();
		$('#wait').show();
		$('#charchoice').html(something.target.id);
	});

	var incrementLoadBar=function(numPeople){
		$('.progress-bar').css('width',numPeople*25+'%');
	}

	var draw_c=function () {
	  //Variables
	  var c_canvas = document.getElementById("c");
	  var context = c_canvas.getContext("2d");
	  var outR = 275;
	  var innR = 225;
	  var numSpaces = 20;
	  var width = c_canvas.width;
	  var height = c_canvas.height;
	  var xMid = (width / 2);
	  var yMid = (height / 2);
	  var health = 80;
	  var money = 4000;
	  
	  //Draw Background
	  context.fillStyle = "#a2a2a2";
	  context.fillRect(0,0, width, height);
	  
	  //Draw Outline
	  context.strokeStyle = "#000000";
	  context.strokeRect(0,0, width, height);
	  
	  //Draw Circle
	  context.lineWidth = 3;
	  context.beginPath();
	  context.arc(xMid,yMid,innR,0,2*Math.PI);
	  context.fillStyle = "#8A0707";
	  context.closePath();
	  context.fill();
	  
	  context.beginPath();
	  context.arc(xMid,yMid,outR,0,2*Math.PI);
	  context.closePath();
	  context.strokeStyle = "#000000";
	  context.stroke();
	  
	  //var even = 0;
	  //Draw Spaces
	  for (var z = 0; z <= 2*Math.PI; z += Math.PI / numSpaces){
	  	context.moveTo((Math.sin(z) * outR) + xMid, (Math.cos(z) * outR) + yMid);
	  	context.lineTo((Math.sin(z) * innR) + xMid, (Math.cos(z) * innR) + yMid);
	  }  
	    
	  context.stroke();
	  
	  //Create Array for Colored Spaces
	  var spaceColor = ["red"];
	  var text = "Colors: ";
	  for (index = 0; index < numSpaces * 2; index++){
	  	switch(index){
	  	case 0:
	  	case 1:
	  		spaceColor[index] = "red"; //hospital spaces
	  		break;
	  	case 6:
	  	case 25:
	  		spaceColor[index] = "#CCB280"; //shop spaces
	  		break;
	  	case 15:
	  	case 30: 
	  		spaceColor[index] = "#251919"; //death cut spaces
	  		break;
	  	case 20:
	  	case 35:
	  		spaceColor[index] = "#009900"; //good fortune spaces
	  		break;
	  	default:
	  		spaceColor[index] = "#FFFF99"; //normal spaces
	  		break;
	  	}
	  }
	  
	  //Draw Multiple Colored Squares
	  var temp = 0;
	  for(var z = 0; z < numSpaces*2; z++){
	    context.beginPath();
	    context.arc(xMid,yMid,outR,(Math.PI/numSpaces) * (z-1),(Math.PI/numSpaces) * z);
	    context.arc(xMid,yMid,innR,(Math.PI/numSpaces) * z,(Math.PI/numSpaces) * (z-1),true);
	    context.closePath();
	    context.fillStyle = spaceColor[z];
	    context.fill();
	  }
	  
	  //Draw 'Game of Death'
	  var deathX = 230;
	  var deathY = 300
	  
	  context.font = '60pt Chiller';
	  context.strokeStyle = "#000000";
	  context.lineWidth = 3;
	  context.strokeText('Game of Death', deathX, deathY);
	  
	  //Draw Health Bar
	  context.fillStyle = "red";
	  context.fillRect(20, height-40, 200 - ((100 - health) * 2), 20);
	  
	  context.beginPath();
	  context.rect(20, height-40, 200, 20);
	  context.strokeStyle = "#000000";
	  context.stroke();
	  
	  //Draw "Health <3"
	  context.font = '12pt Arial';
	  context.fillStyle = "#000000";
	  context.fillText("Health: " + health + " / 100", 110, height-50);
	
	  //Draw Money
	  context.font = '16pt Arial';
	  context.fillStyle = "green";
	  context.fillText("$" + money, width-80, height-30);
	  
	  //Draw Avatar & Name
	  var imageObj = new Image();
	  var p1 = "User";
	  imageObj.src = "http://131.118.95.193/steve/game/images/thebee3.jpg";
	  
	  imageObj.onload = function() {
		context.drawImage(imageObj, 20, 20, 125, 125);
	  };
	  
	  
	  context.beginPath();
	  context.rect(20, 20, 125, 125);
	  context.stroke();
	  
	  context.fillStyle = "black";
	  context.font = '12pt Arial';
	  context.fillText("Player 1", 50, 165);
	  context.fillText(p1, 60, 180);  
    
	}
</script>

</html>
